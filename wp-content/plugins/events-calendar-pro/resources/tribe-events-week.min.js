(function(q,r,b,d,h,e,a,g,m){b(r).ready(function(){function s(){var a=b(".time-row-8AM");b(".tribe-week-grid-wrapper").slimScroll({height:"500px",railVisible:!0,alwaysVisible:!0,start:a})}function v(){b(".tribe-event-placeholder").each(function(){var a=b(this).attr("data-event-id"),a=parseInt(b("#tribe-events-event-"+a).outerHeight());b(this).height(a)})}function w(a){a.each(function(){var a=b(this),c=a.next(),d={left:"0",width:"65%"},x={right:"0",width:"65%"};if(c.length){var f=c.offset(),e=[f.left,
f.left+c.outerWidth()],f=[f.top,f.top+c.outerHeight()],k=a.offset(),g=[k.left,k.left+a.outerWidth()],k=[k.top,k.top+a.outerHeight()];e[0]<g[1]&&(e[1]>g[0]&&f[0]<k[1]&&f[1]>k[0])&&(a.is(".overlap-right")?c.css(d).addClass("overlap-left"):(a.is(".overlap-left")||a.css(d),c.css(x).addClass("overlap-right")))}})}function y(){var a=b(".tribe-grid-body .tribe-grid-content-wrap .column > div[id*='tribe-events-event-']"),d=b(".tribe-week-grid-inner-wrap").height();a.each(function(){var a=b(this),c=a.attr("data-hour"),
e=a.attr("data-duration"),f=a.attr("data-min"),c=b('.tribe-week-grid-block[data-hour="'+c+'"]'),c=c.offset().top-c.parent().offset().top-c.parent().scrollTop(),c=parseInt(Math.round(c))+parseInt(f),f=parseInt(d)-parseInt(e)-parseInt(c);0>f&&(e=e+f-14);a.css({height:e+"px",top:c+"px"}).find("a").css({height:e-16+"px"})});b("div[id^='tribe-events-event-']").css({visibility:"visible",opacity:"0"}).delay(500).animate({opacity:"1"},{duration:250});w(a);a=b(".tribe-grid-header .tribe-grid-content-wrap .column").height();
b(".tribe-grid-header .column").height(a);a=b(".tribe-grid-allday .tribe-grid-content-wrap").height();b(".tribe-grid-allday .column").height(a);a=b(".tribe-grid-body").height();b(".tribe-grid-body .tribe-grid-content-wrap .column").height(a)}function n(a,d){v();for(var e=b(".tribe-grid-allday"),g=e.find(".vevent"),h=parseInt(b(".tribe-grid-content-wrap .column").width())-8,f=1;8>f;f++)g.hasClass("tribe-dayspan"+f)&&e.find(".tribe-dayspan"+f).children("div").css("width",h*f+(4*(2*f-2)+(f-1))+"px");
b(".tribe-grid-body .column:eq(5), .tribe-grid-body .column:eq(6), .tribe-grid-body .column:eq(7)").addClass("tribe-events-right");d&&b(".tribe-grid-content-wrap .column").css("height","auto");y();a&&"function"===typeof a&&a()}function t(c){"change_view"!=tribe_events_bar_action&&(c.preventDefault(),a.ajax_running||(c=b("#tribe-bar-date").val(),a.popping=!1,c.length?(a.date=b("#tribe-bar-date").val(),d.cur_url=d.base_url+a.date+"/"):(a.date=d.cur_date,d.cur_url=d.base_url+d.cur_date+"/"),e.pre_ajax(function(){p()})))}
function p(){b("#tribe-events-header");b(".tribe-events-grid").tribe_spin();a.pushcount=0;a.ajax_running=!0;!a.popping&&(a.filter_cats&&(d.cur_url=d.base_url),a.params={action:"tribe_week",eventDate:a.date},a.url_params={},a.category&&(a.params.tribe_event_category=a.category),b(h).trigger("tribe_ev_serializeBar"),a.params=b.param(a.params),a.url_params=b.param(a.url_params),b(h).trigger("tribe_ev_collectParams"),a.pushstate=!0,a.do_string=!1,0<a.pushcount||a.filters)&&(a.pushstate=!1,a.do_string=
!0);g.pushstate?(m&&debug.time("Week View Ajax Timer"),b(h).trigger("tribe_ev_ajaxStart").trigger("tribe_ev_weekView_AjaxStart"),b.post(TribeWeek.ajaxurl,a.params,function(c){a.initial_load=!1;e.enable_inputs("#tribe_events_filters_form","input, select");if(c.success){a.ajax_running=!1;d.ajax_response={total_count:"",view:c.view,max_pages:"",tribe_paged:"",timestamp:(new Date).getTime()};var g="",g=b.isFunction(b.fn.parseHTML)?b.parseHTML(c.html):c.html;b("#tribe-events-content.tribe-events-week-grid").replaceWith(g);
n(s(),!1);b(".tribe-events-grid").resize(function(){n(!1,!0)});b("div[id*='tribe-events-event-']").hide().fadeIn("fast");a.page_title=b("#tribe-events-header").data("title");r.title=a.page_title;a.do_string&&history.pushState({tribe_url_params:a.url_params,tribe_params:a.params},a.page_title,d.cur_url+"?"+a.url_params);a.pushstate&&history.pushState({tribe_url_params:a.url_params,tribe_params:a.params},a.page_title,d.cur_url);b(h).trigger("tribe_ev_ajaxSuccess").trigger("tribe_ev_weekView_AjaxSuccess");
m&&debug.timeEnd("Week View Ajax Timer")}})):q.location=a.do_string?d.cur_url+"?"+a.url_params:d.cur_url}var z=b("#tribe-events"),l=b("#tribe-events-bar"),u=b("#tribe-events-header");l.addClass("tribe-has-datepicker");a.date=u.data("date");var A=b("#tribe-bar-date").bootstrapDatepicker({format:"yyyy-mm-dd",showAnim:"fadeIn",onRender:function(a){var d=u.data("startofweek"),e=[0,1,2,3,4,5,6];delete e[d];a=a.getDay();for(i=0;i<e.length;i++)if(-1!=b.inArray(a,e))return"disabled";return""}}).on("changeDate",
function(){A.hide()}).data("datepicker");n(s(),!1);b(".tribe-events-grid").resize(function(){n(!1,!0)});g.pushstate&&!g.map_view()&&(l="action=tribe_week&eventDate="+a.date,d.params.length&&(l=l+"&"+d.params),history.replaceState({tribe_params:l,tribe_url_params:d.params},"",location.href),b(q).on("popstate",function(b){if(b=b.originalEvent.state)a.do_string=!1,a.pushstate=!1,a.popping=!0,a.params=b.tribe_params,a.url_params=b.tribe_url_params,e.pre_ajax(function(){p()}),e.set_form(a.params)}));z.on("click",
".tribe-events-sub-nav a",function(c){c.preventDefault();a.ajax_running||(c=b(this),a.popping=!1,a.date=c.attr("data-week"),d.cur_url=c.attr("href"),e.update_picker(a.date),e.pre_ajax(function(){p()}))});b("form#tribe-bar-form").on("submit",function(a){t(a)});if(g.live_ajax()&&g.pushstate)b("#tribe-bar-date").on("changeDate",function(a){g.reset_on()||t(a)});e.snap("#tribe-events-content","body","#tribe-events-footer .tribe-events-nav-previous a, #tribe-events-footer .tribe-events-nav-next a");b(h).on("tribe_ev_runAjax",
function(){p()});m&&debug.info("TEC Debug: tribe-events-week.js successfully loaded");a.view&&m&&debug.timeEnd("Tribe JS Init Timer")})})(window,document,jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.state,tribe_ev.tests,tribe_debug);
